<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>City Survival 3D</title>
    <style>
        body { margin: 0; background: #87CEEB; overflow: hidden; touch-action: none; font-family: sans-serif; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: white; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px #000; pointer-events: none; }
        #joystick { position: absolute; bottom: 40px; left: 40px; width: 80px; height: 80px; background: rgba(255,255,255,0.3); border-radius: 50%; border: 2px solid white; }
        #stick { position: absolute; width: 30px; height: 30px; background: white; border-radius: 50%; top: 25px; left: 25px; }
        #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 30px; display: none; text-align: center; background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px; border: 2px solid #ff0055; }
    </style>
</head>
<body>
    <div id="ui">SCORE: 0</div>
    <div id="msg">ðŸ’¥ CRASHED!<br><span style="font-size:15px">Restarting...</span></div>
    <div id="joystick"><div id="stick"></div></div>
    <canvas id="game"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, score = 0, gameActive = true;
        let enemies = [], buildings = [], moveDir = { x: 0, z: 0 };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Blue Sky
            scene.fog = new THREE.Fog(0x87CEEB, 10, 50);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('game'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // Light
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 10, 7.5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            // Road
            const roadGeo = new THREE.PlaneGeometry(15, 1000);
            const roadMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const road = new THREE.Mesh(roadGeo, roadMat);
            road.rotation.x = -Math.PI/2;
            scene.add(road);

            // Player
            player = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1.5), new THREE.MeshStandardMaterial({ color: 0x00ff00 }));
            player.position.y = 0.5;
            scene.add(player);

            camera.position.set(0, 4, 8);
            camera.lookAt(player.position);

            createCityDecor();
            setupControls();
            animate();
        }

        function createCityDecor() {
            for(let i = 0; i < 50; i++) {
                // Buildings and Churches (Decor)
                let h = 5 + Math.random() * 10;
                let bGeo = new THREE.BoxGeometry(4, h, 4);
                let bMat = new THREE.MeshStandardMaterial({ color: 0x808080 });
                let b = new THREE.Mesh(bGeo, bMat);
                
                let side = Math.random() > 0.5 ? 10 : -10;
                b.position.set(side, h/2, -i * 15);
                scene.add(b);

                // Church Cross (Simple representation)
                if(Math.random() > 0.7) {
                    let cross = new THREE.Mesh(new THREE.BoxGeometry(0.5, 3, 0.5), new THREE.MeshStandardMaterial({color: 0xffd700}));
                    cross.position.set(side, h + 1.5, -i * 15);
                    scene.add(cross);
                }
            }
        }

        function setupControls() {
            const joystick = document.getElementById('joystick');
            const stick = document.getElementById('stick');
            window.addEventListener('touchstart', (e) => updateJoystick(e));
            window.addEventListener('touchmove', (e) => updateJoystick(e));
            window.addEventListener('touchend', () => {
                moveDir = { x: 0, z: 0 };
                stick.style.transform = `translate(0px, 0px)`;
            });
        }

        function updateJoystick(e) {
            const rect = document.getElementById('joystick').getBoundingClientRect();
            const touch = e.touches[0];
            const dx = touch.clientX - (rect.left + 40);
            const dy = touch.clientY - (rect.top + 40);
            const dist = Math.min(Math.sqrt(dx*dx + dy*dy), 30);
            const angle = Math.atan2(dy, dx);
            moveDir.x = Math.cos(angle) * (dist/30) * 0.2;
            moveDir.z = Math.sin(angle) * (dist/30) * 0.2;
            document.getElementById('stick').style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
        }

        function animate() {
            if(!gameActive) return;
            requestAnimationFrame(animate);

            player.position.x += moveDir.x;
            player.position.z -= 0.15; // Auto move forward like PUBG/Free Fire
            
            camera.position.x = player.position.x;
            camera.position.z = player.position.z + 8;

            // Spawning Obstacles (Enemies)
            if(Math.random() < 0.04) {
                let en = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.2), new THREE.MeshStandardMaterial({ color: 0xff0000 }));
                en.position.set((Math.random()-0.5)*12, 0.6, player.position.z - 30);
                enemies.push(en);
                scene.add(en);
            }

            enemies.forEach((en, i) => {
                if(player.position.distanceTo(en.position) < 1.5) gameOver();
                if(en.position.z > player.position.z + 10) {
                    scene.remove(en);
                    enemies.splice(i, 1);
                    score++;
                    document.getElementById('ui').innerText = "SCORE: " + score;
                }
            });

            renderer.render(scene, camera);
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('msg').style.display = 'block';
            setTimeout(() => location.reload(), 2000);
        }

        init();
    </script>
</body>
</html>
